<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Visor de Imágenes - Estilo Facebook</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }

        /* Sección principal de la página */
        #page-home {
            padding: 0;
            margin: 0;
            width: 100%;
        }

        /* Título de la página */
        .page-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 0;
            padding: 15px 15px;
            color: #050505;
            background-color: #fff;
        }

        /* Contenedor de la galería de imágenes */
        .gallery-container {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Responsive para escritorio - dos columnas */
        @media (min-width: 769px) {
            .gallery-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0;
            }

            .gallery-item {
                border-right: 1px solid #e4e6eb;
            }

            .gallery-item:nth-child(2n) {
                border-right: none;
            }
        }

        /* Cada item de la galería */
        .gallery-item {
            cursor: pointer;
            border-radius: 0;
            overflow: hidden;
            background: #fff;
            box-shadow: none;
            border-bottom: 1px solid #e4e6eb;
            transition: background-color 0.2s;
        }

        .gallery-item:hover {
            background-color: #f7f8fa;
        }

        /* Imagen dentro del item */
        .gallery-item img {
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            display: block;
        }

        /* Descripción debajo de cada imagen en la galería */
        .gallery-item-description {
            padding: 12px 15px;
            font-size: 14px;
            color: #050505;
            line-height: 1.4;
        }

        /* Visor modal (fondo oscuro) */
        .image-visor {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            overflow: hidden;
        }

        .image-visor.active {
            display: flex;
            flex-direction: column;
        }

        /* Botón de cerrar (X) */
        .visor-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background-color: rgba(68, 73, 80, 0.8);
            border: none;
            border-radius: 50%;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            transition: background-color 0.2s, opacity 0.25s ease-out;
            will-change: opacity;
        }

        .visor-close.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .visor-close:hover {
            background-color: rgba(68, 73, 80, 1);
        }

        /* Contenedor de la imagen con zoom */
        .visor-image-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: none;
            cursor: pointer;
            background-color: #000;
            /* Altura fija para evitar que cambie al ocultar descripción */
            height: 100vh;
        }

        .image-visor.active .visor-image-container {
            height: calc(100vh - 150px);
        }

        /* Wrapper para la transformación de la imagen */
        .visor-image-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Imagen principal del visor */
        .visor-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            display: block;
            user-select: none;
            -webkit-user-select: none;
            object-fit: contain;
        }

        /* Contenedor de la descripción */
        .visor-description-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #242526;
            color: #e4e6eb;
            padding: 20px;
            max-height: 150px;
            overflow-y: auto;
            transition: transform 0.25s ease-out;
            transform: translateY(0);
            z-index: 10001;
            will-change: transform;
        }

        .visor-description-container.hidden {
            transform: translateY(100%);
        }

        .visor-description {
            font-size: 15px;
            line-height: 1.5;
        }

        /* Responsive para tablets */
        @media (max-width: 768px) {
            .page-title {
                font-size: 20px;
                padding: 12px 15px;
            }

            .gallery-item-description {
                padding: 10px 15px;
                font-size: 14px;
            }

            .visor-description-container {
                max-height: 120px;
                padding: 15px;
            }

            .visor-close {
                width: 38px;
                height: 38px;
                font-size: 22px;
            }

            .image-visor.active .visor-image-container {
                height: calc(100vh - 120px);
            }
        }

        /* Responsive para móviles */
        @media (max-width: 480px) {
            .page-title {
                font-size: 18px;
                padding: 10px 12px;
            }

            .gallery-item-description {
                padding: 10px 12px;
                font-size: 13px;
            }

            .visor-close {
                width: 36px;
                height: 36px;
                font-size: 20px;
                top: 10px;
                right: 10px;
            }

            .visor-description-container {
                max-height: 100px;
                padding: 12px;
            }

            .visor-description {
                font-size: 14px;
            }

            .image-visor.active .visor-image-container {
                height: calc(100vh - 100px);
            }
        }
    </style>
</head>
<body>
    <!-- Página principal con galería de imágenes -->
    <div id="page-home" class="page-section">
        <h1 class="page-title">Mis Fotos</h1>
        
        <div class="gallery-container" id="galleryContainer">
            <!-- Las imágenes se generarán dinámicamente con JavaScript -->
        </div>
    </div>

    <!-- Visor de imágenes modal -->
    <div class="image-visor" id="imageVisor">
        <button class="visor-close" id="visorClose" aria-label="Cerrar">&times;</button>
        
        <div class="visor-image-container" id="visorImageContainer">
            <div class="visor-image-wrapper" id="visorImageWrapper">
                <img src="" alt="" class="visor-image" id="visorImage">
            </div>
        </div>
        
        <div class="visor-description-container" id="visorDescriptionContainer">
            <p class="visor-description" id="visorDescription"></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/umd/photoswipe.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/umd/photoswipe-lightbox.umd.min.js"></script>
    <script>
        // Datos de ejemplo para las imágenes
        const imageData = [
            {
                src: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800',
                description: 'Hermoso paisaje de montañas al atardecer con cielo despejado y nubes rosadas.'
            },
            {
                src: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800',
                description: 'Naturaleza en su máximo esplendor, bosque verde con árboles altos.'
            },
            {
                src: 'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800',
                description: 'Playa paradisíaca con arena blanca y agua cristalina color turquesa.'
            },
            {
                src: 'https://images.unsplash.com/photo-1475924156734-496f6cac6ec1?w=800',
                description: 'Atardecer en el campo con flores silvestres y cielo naranja.'
            },
            {
                src: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=800',
                description: 'Lago tranquilo rodeado de montañas con reflejo perfecto en el agua.'
            },
            {
                src: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800',
                description: 'Sendero en el bosque con luz del sol filtrándose entre los árboles.'
            }
        ];

        // Referencias a elementos del DOM
        const galleryContainer = document.getElementById('galleryContainer');
        const imageVisor = document.getElementById('imageVisor');
        const visorClose = document.getElementById('visorClose');
        const visorImage = document.getElementById('visorImage');
        const visorDescription = document.getElementById('visorDescription');
        const visorDescriptionContainer = document.getElementById('visorDescriptionContainer');
        const visorImageContainer = document.getElementById('visorImageContainer');
        const visorImageWrapper = document.getElementById('visorImageWrapper');

        // Variables para el manejo de zoom y gestos con PhotoSwipe
        let scale = 1;
        let posX = 0;
        let posY = 0;
        let isDescriptionVisible = true;
        let currentImageIndex = 0;
        
        // Variables para gestos táctiles mejorados
        let touchStartX = 0;
        let touchStartY = 0;
        let touchStartDistance = 0;
        let touchStartScale = 1;
        let touchStartPosX = 0;
        let touchStartPosY = 0;
        let isMultiTouch = false;
        let isSingleTouchMove = false;
        let hasMoved = false;
        
        // Variables para detección de clics y doble clic
        let lastTapTime = 0;
        let tapTimeout = null;

        // Generar galería de imágenes
        function generateGallery() {
            imageData.forEach((item, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.innerHTML = `
                    <img src="${item.src}" alt="Imagen ${index + 1}">
                    <div class="gallery-item-description">${item.description}</div>
                `;
                
                // Evento para abrir el visor al hacer clic
                galleryItem.addEventListener('click', () => openVisor(index));
                galleryContainer.appendChild(galleryItem);
            });
        }

        // Abrir el visor con la imagen seleccionada
        function openVisor(index) {
            const item = imageData[index];
            currentImageIndex = index;
            visorImage.src = item.src;
            visorDescription.textContent = item.description;
            imageVisor.classList.add('active');
            document.body.style.overflow = 'hidden';
            resetZoom();
            showControls();
        }

        // Cerrar el visor
        function closeVisor() {
            imageVisor.classList.remove('active');
            document.body.style.overflow = '';
            resetZoom();
        }

        // Resetear zoom y posición
        function resetZoom() {
            scale = 1;
            posX = 0;
            posY = 0;
            updateTransform();
        }

        // Actualizar transformación de la imagen
        function updateTransform() {
            visorImageWrapper.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
            visorImageWrapper.style.transition = (isMultiTouch || isSingleTouchMove) ? 'none' : 'transform 0.25s ease-out';
        }

        // Mostrar controles (descripción y botón X)
        function showControls() {
            isDescriptionVisible = true;
            visorDescriptionContainer.classList.remove('hidden');
            visorClose.classList.remove('hidden');
        }

        // Ocultar controles (descripción y botón X)
        function hideControls() {
            isDescriptionVisible = false;
            visorDescriptionContainer.classList.add('hidden');
            visorClose.classList.add('hidden');
        }

        // Toggle de controles con detección de clic simple (solo desktop)
        visorImageContainer.addEventListener('click', (e) => {
            // Solo funciona en desktop (no en touch)
            if (e.pointerType === 'mouse' || (!('ontouchstart' in window) && e.type === 'click')) {
                const currentTime = new Date().getTime();
                const timeSinceLastTap = currentTime - lastTapTime;
                
                // Detectar doble clic
                if (timeSinceLastTap < 300 && timeSinceLastTap > 0) {
                    e.preventDefault();
                    clearTimeout(tapTimeout);
                    handleDoubleClick(e);
                    lastTapTime = 0;
                    return;
                }
                
                // Clic simple - esperar para ver si viene otro
                lastTapTime = currentTime;
                clearTimeout(tapTimeout);
                
                tapTimeout = setTimeout(() => {
                    if (scale === 1 && !isMultiTouch && !isSingleTouchMove) {
                        toggleControls();
                    }
                    lastTapTime = 0;
                }, 300);
            }
        });
        
        // Prevenir el comportamiento por defecto de iOS que causa zoom
        visorImageContainer.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        });
        
        visorImageContainer.addEventListener('gesturechange', (e) => {
            e.preventDefault();
        });
        
        visorImageContainer.addEventListener('gestureend', (e) => {
            e.preventDefault();
        });
        
        // Función para alternar controles
        function toggleControls() {
            if (isDescriptionVisible) {
                hideControls();
            } else {
                showControls();
            }
        }
        
        // Función para manejar doble clic
        function handleDoubleClick(e) {
            if (scale === 1) {
                // Hacer zoom in al 2.5x
                const rect = visorImageContainer.getBoundingClientRect();
                const clickX = e.clientX || e.touches?.[0]?.clientX || rect.width / 2;
                const clickY = e.clientY || e.touches?.[0]?.clientY || rect.height / 2;
                
                scale = 2.5;
                
                // Centrar el zoom en el punto del clic
                const offsetX = (rect.width / 2 - clickX) * (scale - 1);
                const offsetY = (rect.height / 2 - clickY) * (scale - 1);
                
                posX = offsetX;
                posY = offsetY;
                
                updateTransform();
            } else {
                // Volver al tamaño original
                scale = 1;
                posX = 0;
                posY = 0;
                updateTransform();
            }
        }

        // Evento para cerrar el visor
        visorClose.addEventListener('click', closeVisor);

        // Cerrar al hacer clic en el fondo (solo si no hay zoom)
        imageVisor.addEventListener('click', (e) => {
            if (e.target === imageVisor && scale === 1) {
                closeVisor();
            }
        });

        // Cerrar con la tecla Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && imageVisor.classList.contains('active')) {
                closeVisor();
            }
        });

        // Manejo de eventos táctiles mejorado para pinch-to-zoom fluido
        visorImageContainer.addEventListener('touchstart', (e) => {
            const touches = e.touches;
            hasMoved = false;
            
            if (touches.length === 2) {
                // Inicio del gesto de pinch
                e.preventDefault();
                isMultiTouch = true;
                isSingleTouchMove = false;
                clearTimeout(tapTimeout);
                
                touchStartDistance = getDistance(touches[0], touches[1]);
                touchStartScale = scale;
                
                touchStartPosX = posX;
                touchStartPosY = posY;
                
            } else if (touches.length === 1) {
                // Inicio de un toque simple
                isMultiTouch = false;
                isSingleTouchMove = false;
                
                touchStartX = touches[0].clientX;
                touchStartY = touches[0].clientY;
                touchStartPosX = posX;
                touchStartPosY = posY;
            }
        }, { passive: false });

        visorImageContainer.addEventListener('touchmove', (e) => {
            const touches = e.touches;
            
            // Detectar si hubo movimiento significativo (más de 10px)
            if (touches.length === 1 && !isMultiTouch) {
                const deltaX = Math.abs(touches[0].clientX - touchStartX);
                const deltaY = Math.abs(touches[0].clientY - touchStartY);
                if (deltaX > 10 || deltaY > 10) {
                    hasMoved = true;
                }
            } else {
                hasMoved = true;
            }
            
            if (touches.length === 2 && isMultiTouch) {
                // Gesto de pinch en progreso
                e.preventDefault();
                
                const currentDistance = getDistance(touches[0], touches[1]);
                const scaleChange = currentDistance / touchStartDistance;
                
                scale = touchStartScale * scaleChange;
                scale = Math.max(1, Math.min(scale, 5)); // Limitar entre 1x y 5x
                
                // Si llegamos a escala 1, resetear posición
                if (scale <= 1.01) {
                    scale = 1;
                    posX = 0;
                    posY = 0;
                }
                
                updateTransform();
                
            } else if (touches.length === 1 && scale > 1) {
                // Arrastrar la imagen cuando está con zoom
                e.preventDefault();
                isSingleTouchMove = true;
                
                const deltaX = touches[0].clientX - touchStartX;
                const deltaY = touches[0].clientY - touchStartY;
                
                posX = touchStartPosX + deltaX;
                posY = touchStartPosY + deltaY;
                
                // Limitar el arrastre para que no se salga demasiado
                const maxOffset = 200;
                posX = Math.max(-maxOffset * scale, Math.min(maxOffset * scale, posX));
                posY = Math.max(-maxOffset * scale, Math.min(maxOffset * scale, posY));
                
                updateTransform();
            }
        }, { passive: false });

        visorImageContainer.addEventListener('touchend', (e) => {
            const wasMultiTouch = isMultiTouch;
            const wasSingleTouchMove = isSingleTouchMove;
            
            // Si no se movió y es un tap simple (no fue pinch ni arrastre)
            if (!hasMoved && e.touches.length === 0 && !wasMultiTouch && !wasSingleTouchMove) {
                e.preventDefault();
                e.stopPropagation();
                
                const currentTime = new Date().getTime();
                const timeSinceLastTap = currentTime - lastTapTime;
                
                // Detectar doble tap (menos de 400ms para iOS)
                if (timeSinceLastTap < 400 && timeSinceLastTap > 50 && lastTapTime > 0) {
                    // Doble tap detectado
                    clearTimeout(tapTimeout);
                    
                    const touch = e.changedTouches[0];
                    handleDoubleClick({ 
                        clientX: touch.clientX, 
                        clientY: touch.clientY 
                    });
                    lastTapTime = 0;
                } else {
                    // Tap simple - esperar para ver si viene otro
                    lastTapTime = currentTime;
                    clearTimeout(tapTimeout);
                    
                    // Timeout más largo para iOS (350ms)
                    tapTimeout = setTimeout(() => {
                        if (scale === 1) {
                            toggleControls();
                        }
                        lastTapTime = 0;
                    }, 350);
                }
            }
            
            // Resetear flags después de un pequeño delay
            if (e.touches.length === 0) {
                setTimeout(() => {
                    isMultiTouch = false;
                    isSingleTouchMove = false;
                    hasMoved = false;
                }, 150);
                
                // Si la escala es muy cercana a 1, resetear completamente
                if (scale < 1.1 && scale !== 1) {
                    scale = 1;
                    posX = 0;
                    posY = 0;
                    updateTransform();
                }
            }
        }, { passive: false });

        // Soporte para zoom con rueda del mouse (desktop)
        visorImageContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const delta = e.deltaY * -0.005;
            const rect = visorImageContainer.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const oldScale = scale;
            scale += delta;
            scale = Math.max(1, Math.min(5, scale));
            
            if (scale > 1) {
                // Ajustar posición basándose en la posición del mouse
                const scaleChange = scale / oldScale;
                posX = mouseX - (mouseX - posX) * scaleChange;
                posY = mouseY - (mouseY - posY) * scaleChange;
            } else {
                posX = 0;
                posY = 0;
            }
            
            updateTransform();
        }, { passive: false });

        // Función auxiliar para calcular distancia entre dos puntos táctiles
        function getDistance(touch1, touch2) {
            const dx = touch1.clientX - touch2.clientX;
            const dy = touch1.clientY - touch2.clientY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // Inicializar la galería al cargar la página
        generateGallery();
    </script>
</body>
</html>
